{% load static %}

<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta http-equiv="X-UA-Compatible" content="ie=edge"/>
    <link rel="icon" href="{% static 'img/fav-logo2.png' %}" type="image/x-icon" />
    
    <title>1GOV - BOLETIM DE PRODUÇÃO AMBULATORIAL</title>
    
    <link rel="stylesheet" href="{% static '@govbr-ds/core/dist/core.css' %}"/>
   
    <style>
        body {position: relative; font-family: Arial, sans-serif; margin: 0; padding: 0; border-left: 1px solid var(--gray-20); border-right: 1px solid var(--gray-20);}
        .header {top: 0; left: 0; right: 0; z-index: 1000; border-bottom: 1px solid var(--gray-20); border-top: 1px solid var(--gray-20); text-align: center; padding: 0px !important;}
        .header .row {display: flex; align-items: center; justify-content: space-between;}
        
        .divider-text {position: relative; padding-top: 20px; border: 1px solid var(--gray-20);}
        .divider-text::after {position: absolute; top: 0; left: 35px; background: white; padding: 0 20px; margin-top: -10px; color: #333333;}
        .divider-text-dados-operacionais::after {content: "Dados Operacionais";}
        .divider-text-paciente::after {content: "Identificação do paciente"; font-size:13px !important; font-weight: bold;}
        .divider-text-responsavel::after {content: "Responsável pelo estabelecimento";}
        .divider-text-gestor::after {content: "Gestor Municipal/Estadual";}
        
        table {width: 88%; margin: 0 auto; table-layout: fixed; border-collapse: collapse;}
        th {background-color: #fff; padding-left: 3px !important; font-size: 13px !important;}
        td {padding: 3px; font-size: 13px !important;}
        th, td {text-align: start !important; border: 0px solid #fff !important;}
        th:nth-child(1), td:nth-child(1) {width: 15%;}
        th:nth-child(2), td:nth-child(2) {width: 70%;}
        th:nth-child(3), td:nth-child(3) {width: 15%;}
        
        @page {@bottom-center {content: element(footer);}}
        @page {size: 260mm 297mm; margin: 10mm;}
        .page-break {page-break-before: always;}

        .hr-title{ border: 1px solid var(--gray-20); width:100%; }

        .hr-divider{ border: 1px solid var(--gray-20); width:100%; margin-top: 10px !important;  }

        .container {margin-top: 10px;}
        .fixed-footer {
            width: 100%;
            border-bottom: 1px solid var(--gray-20) !important;
            border-left: 1px solid var(--gray-20) !important;
            border-right: 1px solid var(--gray-20) !important;
        }
        

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        th, td {
            text-align: left;
            padding: 8px;
            vertical-align: top;
        }

        th {
            font-weight: bold;
        }

        .label {
            font-weight: normal;
            font-size:13px !important;
        }
        span{ font-size:13px !important; }
        p{ font-size:13px !important; }
        .section-title {
            text-align: left;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        /* Estilo para o divisor */
        .hr-divider { 
            border: 1px solid var(--gray-20); 
            width:100%; 
            margin-top: 10px !important;  
        }

        .divider {
            display: flex;
            align-items: center;
            gap: 10px; /* Espaçamento entre o texto e a linha */
            margin: 20px 0;
        }

        .divider span {
            font-weight: bold;
            white-space: nowrap; /* Impede quebra de linha */
        }

        th {
            width: auto;
            padding: 5px 10px;
        }
        th:nth-child(1) { width: 15%; } /* Data Atend. */
        th:nth-child(2) { width: 15%; } /* Procedimento */
        th:nth-child(3) { width: 46%; } /* Descrição */
        th:nth-child(4) { width: 8%; text-align: center !important; } /* Qtde */
        th:nth-child(5) { width: 8%; text-align: center !important; } /* Idade */
        th:nth-child(6) { width: 8%; text-align: center !important; } /* CID */


    </style>
</head>
<body>
    <div class="header fixed-header">
        <div class="row">
            <div class="col-3 mt-3 m-3">
                <img class="logo" src="{% static 'img/logo_sus.png' %}" style="width: 130px" alt="Logo"/>
            </div>
            <div class="col-9 text-center">
                <h3 class="mt-3">
                    BPA-I BOLETIM DE PRODUÇÃO AMBULATORIAL <br/>
                    DADOS INDIVIDUALIZADOS 
                </h3>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="row" style="height:21px;">
            <div class="text-center" style="width:15%;">
                <p style="margin-left:10px;">CNES: <b>{{unidade_saude.cnes|default:'------------'}}</b></p>
            </div>
            <div class="text-center" style="width:50%;">
                <p>Estabelecimento de Saúde: <b>{{unidade_saude.nome|default:'-----'}}</b></p>
            </div>
            <div class="text-center" style="width:15%;">
                <p> UF: <b>{{unidade_saude.municipio.estado.sigla}}</b></p>
            </div>
            <div class="text-center" style="width:20%;">
                <p>Competência: <b>{{mes_formatado}}/{{ano_selecionado}}</b></p> 
            </div>
        </div>
    </div>

    {% for resultado in resultado_final %}
        <div class="container mt-3" style="width:90%; margin-left:40px;">
            <div class="row">
                <div class="col-auto">
                    <p>CNES Profissional: <b>{{resultado.profissional.cns|default:"------------"}}</b></p>
                </div>
                <div class="col-auto">
                    <p style="margin-left:35px;">Nome Profissional: <b>{{resultado.profissional.nome_profissional|default:"-----"}}</b></p>
                </div>
                <div class="col-2 text-center">
                    <p> CBO: <b>{{resultado.profissional.cbo|default:"------"}}</b></p>
                </div>
                <div class="col-2 text-center">
                    <p>Cód INE: <b>-------</b></p> 
                </div>
            </div>
        </div>

        {% for paciente in resultado.pacientes %}
            <div class= "container mt-2" style="background-color:;"> 
                <div class="container divider-text divider-text-paciente title-hr box-card-border mt-1" style="background-color:;">
                    <div class="row">
                        <!-- section 01: identificação paciente -->
                        <div class="col-12 text-center">
                            <table>
                                <tr>
                                    <th colspan="4"></th>
                                </tr>
                                <tr>
                                    <td><span class="label">CNS: </span><strong>{{paciente.paciente.cartao_sus|default:" ----- "|title }}</strong></td>
                                    <td><span class="label">Nome: </span><strong>{{paciente.paciente.nome_paciente|default:" ----- "|title }}</strong></td>
                                    <td><span class="label">Sexo: </span><strong>{{paciente.paciente.sexo|default:" ----- " }}</strong></td>
                                    <td><span class="label">Data Nasc.: </span><strong>{{paciente.paciente.data_nascimento|default:" ----- " }}</strong></td>
                                </tr>
                                <tr>
                                    <td><span class="label">Nacionalidade: </span><strong>{{paciente.paciente.nacionalidade|default:" ----- "|title }}</strong></td>
                                    <td><span class="label">Raça: </span><strong>{{paciente.paciente.get_raca_display|default:" ----- "|title }}</strong></td>
                                    <td><span class="label">Etnia: </span><strong>{{ paciente.paciente.etnia|default:" ----- "|title }}</strong></td>
                                    <td><span class="label">CEP: </span><strong>{{paciente.paciente.cep|default:" ----- " }}</strong></td>
                                </tr>
                                <tr>
                                    <td><span class="label">Endereço: </span><strong>{{paciente.paciente.endereco|default:" ----- "|title }}</strong></td>
                                    <td><span class="label">Nº: </span><strong>{{paciente.paciente.numero|default:" ----- " }}</strong></td>
                                    <td><span class="label">Bairro: </span><strong>{{paciente.paciente.bairro|default:" ----- "|title }}</strong></td>
                                    <td><span class="label">Comp.:</span><strong>{{paciente.paciente.complemento|default:" ----- "|title }}</strong></td>
                                </tr>
                                <tr>
                                    <td><span class="label">UF: </span><strong>{{paciente.paciente.estado|default:" ----- " }}</strong></td>
                                    <td><span class="label">Município: </span><strong>{{paciente.paciente.municipio|default:" ----- "|title }}</strong></td>
                                    <td><span class="label">Telefone: </span><strong>{{paciente.paciente.celular|default:" ----- " }}</strong></td>
                                    <td><span class="label">E-mail: </span><strong>{{paciente.paciente.email|default:" ----- "|title }}</strong></td>
                                </tr>
                            </table>
                        </div>

                        <!-- section 02: atendimento_realizado -->
                        <div class="col-12">
                            <div class="row" style="width:80%; margin:0 auto;">
                                <div class="col-4 text-center">
                                    <span><b>Atendimentos Realizados</b></span>
                                </div>
                                <div class="col-8">
                                    <hr class="hr-divider">
                                </div>
                            </div>

                            <div class="row" style="background-color:;">
                                <div class="col-12 text-center pb-2">
                                    <table>
                                        <thead>
                                            <tr>
                                                <th>Data Atend.</th>
                                                <th>Procedimento</th>
                                                <th>Descrição</th>
                                                <th class="">Qtde</th>
                                                <th>Idade</td>
                                                <th>CID</th>    
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for procedimento in paciente.procedimentos %}
                                                <tr class="pt-4">
                                                    <td>{{procedimento.atendimento.lista_chamada.classificacao_risco.boletim.created_at}}</td>
                                                    <td><b>{{procedimento.procedimento.codigo}}</b></td>
                                                    <td>{{procedimento.procedimento.nome}}</td>
                                                    <td class="text-center">{{procedimento.quantidade}}</td>
                                                    <td class="text-center">{{procedimento.atendimento.paciente.calcular_idade}}</td>
                                                    <td class="text-center">{{procedimento.atendimento.atendimento_diagnostico_atendimento_set.id}}</td>
                                                </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div> 
        {% endfor %}
    {% endfor %}

    {% for page in paginated_data %}
        <div class="row" style="width:90%; display: flex;">
            <div class="col-4 text-center">
                <span><b>Atendimentos Realizados</b></span>
            </div>
            <div class="col-8 text-center">
                <hr class="hr-title">
            </div>
        </div>

        <table class="mt-1">
            <thead>
                <tr>
                    <th>Procedimento</th>
                    <th>Descrição</th>
                    <th style="text-align: center !important;">Quantidade</th>
                </tr>
            </thead>
            <tbody>
                {% if page.objects %}
                    {% for procedimento in page.objects %}
                        <tr class="pt-4">
                            <td><b>{{procedimento.codigo}}</b></td>
                            <td>{{procedimento.nome}}</td>
                            <td style="text-align: center !important;">{{procedimento.total}}</td>
                        </tr>
                    {% endfor %}
                    <tr>
                        <td></td>
                        <td></td>
                        <td style="margin-top: 5px; text-align: center !important; font-size: 14px !important;"><b>Total: {{page.total_geral}}</b></td>
                    </tr>
                {% else %}
                    <tr>
                        <td class="p-4 text-center" colspan="4">Nenhuma informação encontrada nesta pesquisa.</td>
                    </tr>
                {% endif %}
            </tbody>
        </table>

         <div class="page-break"></div>
    {% endfor %}

    <!-- assinaturas.footer -->
    <div class="fixed-footer">
        <div class="row p-2">
            <div class="col-6 p-1">
                <div class="container divider-text divider-text-responsavel title-hr box-card-border mt-4">
                    <div class="row">
                        <div class="col-12 text-center pb-5">
                            <span class="mt-2">Assinatura Digital</span>
                            <div style="padding: 17px;"></div>
                        </div>
                        <div class="col-12">
                            <span class="mt-2">Data: {{data_atual}}</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-6 p-1">
                <div class="container divider-text divider-text-gestor title-hr box-card-border mt-4">
                    <div class="row">
                        <div class="col-12 text-center pb-5">
                            <span class="mt-2">Assinatura Digital</span>
                            <div style="padding: 17px;"></div>
                        </div>
                        <div class="col-12">
                            <span class="mt-2">Data: {{data_atual}}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
